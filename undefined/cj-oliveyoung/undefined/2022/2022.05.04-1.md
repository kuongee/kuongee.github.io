# 2022.05.04 네트워크 계층 따라가보기 (1장)

부제: 가보자 www.oliveyoung.co.kr\~!!

생각해보기: 브라우저에서 url을 입력하고 나면 어떤 일이 일어날까?

![](<../../../../.gitbook/assets/image (17).png>)

브라우저에 [www.oliveyoung.co.kr](http://www.oliveyoung.co.kr/) 입력했을 때 어떻게 네트워크를 통해서 우리에게 화면을 보여주는지를 따라가보려고 한다.\


#### 위쪽 레벨에서 부터 보자 <a href="#id-2022.05.04-1" id="id-2022.05.04-1"></a>

"www.oliveyoung.co.kr" 만으로는 실제 주소를 찾아갈 수 없기 때문에 DNS를 통해 서버의 IP 주소를 알아내어 찾아간다.

하지만 아무렇게나 가서 통신할 수 없기 때문에 약속된 언어, 프로토콜로 통신하는데 여기서는 HTTP(S) 라는 프로토콜을 사용한다.

웹 서버에는 HTTP를 처리할 수 있는 프로세스가 돌고 있어서 들어온 요청에 HTML과 같은 데이터로 응답한다.



이제 여기서 좀 더 내려가보자!\


이렇게 층을 따라 내려가볼건데 현재 대부분의 프로토콜들이 TCP/IP 위에서 동작하고 있기도 하고

현실 반영되어 고려해야할 부분에 좀 더 집중할 수 있게 4개의 층으로 나누기도 하는데 여기서도 이렇게 4개의 층으로 한번 정리해본다.

![](<../../../../.gitbook/assets/image (27).png>)

#### 애플리케이션 단에서의 처리 <a href="#id-2022.05.04-1" id="id-2022.05.04-1"></a>

HTTP 프로토콜 같은 애플리케이션 프로토콜은 사용자 공간에서 처리하여 데이터를 만들면 소켓을 열고 소켓에 기록함으로 아래로 전달한다.

TCP/IP로 통신하겠다고 커널에 알리면 소켓을 만들어준다. 그 아래쪽 일은 애플리케이션 단에서는 모름!

#### TCP 단계 <a href="#id-2022.05.04-1-tcp" id="id-2022.05.04-1-tcp"></a>

그 다음 소켓에 기록된 데이터는 TCP 프로토콜을 거친다. TCP는 이전에 들었듯이 신뢰도가 높은 데이터 전송을 해준다.

각 계층에서는 전송할 수 있는 최대 데이터 크기가 있기 때문에 쪼개고 헤더 붙이는 작업이 필요하다.

TCP는 Segment 라는 단위로 불리게 되고 MSS (Maximum Segment Size)에 맞게 데이터를 쪼개서 아래로 전달한다.

예를 들어&#x20;

애플리케이션 데이터 크기가 2000Byte 이고 MSS가 1460Byte라고 한다면

2000 = 1460 + 540 두개로 나누고 각각 헤더를 붙여 TCP segment를 만든다.

#### IP 처리 <a href="#id-2022.05.04-1-ip" id="id-2022.05.04-1-ip"></a>

IP의 역할은 최종 목적지에 데이터를 전송하는 것이다. 라우팅을 통해 다양한 경로로 데이터를 전달할 수 있다.

위에서 만든 TCP segment에 IP 헤더를 추가해 IP packet 을 만든다.

IP 헤더에는 버전, 전송 출발/도착지 포트, TTL 등등의 정보가 기록되어있다.

#### 링크 계층의 이더넷 <a href="#id-2022.05.04-1" id="id-2022.05.04-1"></a>

동일 네트워크 내 데이터 전송하는 역할을 한다.

위에서 만든 IP packet을 이더넷 frame으로 만들고 NIC에 전달되어 전기 신호로 전송된다.

MAC 주소를 사용한다.

![](<../../../../.gitbook/assets/image (26).png>)

지금까지의 과정을 Encapsulation이라고 하고 이 과정을 통해 실제 물리적인 서버, 스위치... 를 경유해 통신을 하게 된다.

(동일 네트워크 내에서는 L2스위치 MAC 주소를 확인해서 이동하지만 다른 네트워크를 통해야하는 경우 L3 스위치나 라우터가 IP 헤더까지 확인해서 목적지 결정)

이후 최종 목적지 서버 NIC에 이더넷 프레임이 도착한다.

위에서 하나하나 감쌌던 과정을 반대로 하나하나 풀러 꺼낸다. 이 과정을 Decapsulation이라고 한다.

이더넷 프레임 → IP 패킷 (IP 주소 확인) → TCP 세그먼트 (포트 번호 맞는지 확인) → 애플리케이션 데이터로 재구성 하여 소켓을 통해 전달한다.

위로 올라갈 때는 어떤 상위 프로토콜로 올려보내주어야 할지 모르기 때문에 헤더에 그 정보를 적어주어야 한다.

예를 들어 HTTP는 TCP 80포트로 보내!라고 알려줘야한다.

#### 교재 외 참고한 자료들 <a href="#id-2022.05.04-1" id="id-2022.05.04-1"></a>

* 그림으로 공부하는 IT 인프라 구조 (jpub)
* [https://blog.rhostem.com//posts/2018-07-22-web-architecture-101](https://blog.rhostem.com/posts/2018-07-22-web-architecture-101)\

  * 2018년도 자료이지만 간단하게 전체적인 인프라가 잘 설명되어있음

\
