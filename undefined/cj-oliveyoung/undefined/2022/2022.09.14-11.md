# 2022.09.14 이중화 기술 (11장)

11장

※ 용어는 벤더마다 다르고 표준 용어가 아닌 용어도 있지만 책 기준으로 설명

**이중화**는 안정적인 서비스 제공을 위한 필수 요소

SPoF (Single Point of Failure) (단일 장애점)를 만들지 말자! (최소화X)

* SPoF: 시스템 구성 요소 중 동작하지 않으면 전체 시스템이 중단되는 요소\


<figure><img src="../../../../.gitbook/assets/image (37).png" alt=""><figcaption><p>(<a href="https://avinetworks.com/glossary/single-point-of-failure/">https://avinetworks.com/glossary/single-point-of-failure/</a>)</p></figcaption></figure>

인프라를 구성하는 각 요소를 복수 개 이상으로 구성해 어떤 요소에서 문제가 발생하더라도 이중화된 다른 인프라를 통해 서비스가 지속되도록 함

\=> 가용성, 연속성, 안정성\


<figure><img src="../../../../.gitbook/assets/image (8).png" alt=""><figcaption><p><a href="https://haeunyah.tistory.com/122)">https://haeunyah.tistory.com/122<br></a></p></figcaption></figure>

#### 이중화 구성 형태 <a href="#id-2022.09.14" id="id-2022.09.14"></a>

* 액티브-액티브 형태\
  : 이중화 구성을 할 때 동시에 운영 중인 상태로 동작\
  이 형태의 경우 이중화된 인프라도 꼭 장애 상황이 아니더라도 서비스를 동시 처리할 수 있음
* 액티브-스탠바이 형태\
  : 하나는 운영 상태이고 하나는 대기 상태로 있다가 장애 발생 시에 운영상태로 가는 형태

#### **이중화 구현을 위한 기술들** <a href="#id-2022.09.14" id="id-2022.09.14"></a>

#### LACP (Link Aggregation Control Protocol) <a href="#id-2022.09.14-lacp-linkaggregationcontrolprotocol" id="id-2022.09.14-lacp-linkaggregationcontrolprotocol"></a>

* 대역폭 확장 목적 - 링크 사용률 향상, 향상된 장애 회복
* 두 개 이상의 물리 인터페이스를 하나의 논리 인터페이스를 이용해 대역폭을 확장
* 액티브-액티브 구조

![](<../../../../.gitbook/assets/image (31).png>)[https://ja-gamma.tistory.com/entry/LACP개념동작원리](https://ja-gamma.tistory.com/entry/LACP%EA%B0%9C%EB%85%90%EB%8F%99%EC%9E%91%EC%9B%90%EB%A6%AC\))

LACP 동작 방식

* LACP를 구성하기 위한 출발지 주소, 목적지 주소, 타입 버전 정보 등을 포함한 LACPDU를 사용해 매 초마다 주고 받음
* LACP를 구성할 때는 LACPDU를 주고 받는 장비 상호 간 구성이 1:1로 되어야 함
* LACP를 구성할 장비 모두 LACP를 설정해주어야
  * A 스위치에서 LACPDU 먼저 송신 ↔ B 스위치에서 수신\
    \=> LACP 구성됨

![](<../../../../.gitbook/assets/image (2).png>)

(왼쪽만 LACP 구성 가능)



#### MC-LAG (Multi-chassis Link Aggregation Group) <a href="#id-2022.09.14-mc-lag-multi-chassislinkaggregationgroup" id="id-2022.09.14-mc-lag-multi-chassislinkaggregationgroup"></a>

위의 그림 "왼쪽" LACP 구성 그림에서 스위치 한개가 아예 장애가 발생 할 수도 있는데 "오른쪽" 그림처럼 서로 다른 스위치로 구성하면 좀 더 안전하지 않을까? 가능?

MC-LAG

* 서로 다른 스위치 간의 단일 가상 MAC 주소를 사용할 수 있도록 함\
  → 액티브-액티브 형태, 논리 인터페이스로 LACP를 구성

![](<../../../../.gitbook/assets/image (5).png>) [https://www.juniper.net/documentation/kr/ko/software/junos/mc-lag/topics/concept/mc-lag-feature-summary-best-practices.html](https://www.juniper.net/documentation/kr/ko/software/junos/mc-lag/topics/concept/mc-lag-feature-summary-best-practices.html)

동작

![](<../../../../.gitbook/assets/image (1).png>)

* Peer 장비: MC-LAG을 구성하는 장비
* Peer-Link: 두 Peer 장비 간 데이터 및 제어 패킷을 주고받는 경로 (Peer 끼리 통신 가능한 IP 설정 필요)
* MC-LAG 도메인: 두 Peer 장비를 하나의 논리 장비로 구성하기 위한 영역 ID\
  MC-LAG 구성하기 전 각 Peer에 동일한 도메인 ID를 부여



MC-LAG 구성을 위한 제어 패킷을 주고 받아 정상적으로 완료되면 두 Peer 장비는 MC-LAG 도메인으로 묶이고 가상 MAC 주소를 각 Peer 장비에 동일하게 생성됨

MC-LAG이 설정된 스위치에 가상 MAC 주소로 LACPCU를 전송하면서 LACP로 이중화 구성

\
\------------------------------------------------------

여기서 잠깐✋ STP (Spanning Tree Protocol)

책 4.3 STP 참고

![](<../../../../.gitbook/assets/image (24).png>)

루프 구조로 연결된 상태에서 2계층에서는 패킷의 라이프사이클을 확인할 수가 없어 죽지 않고 계속 살아남아있게 되어 시스템/네트워크 리소스를 잡아먹게 됨 등등의 이유로

STP라는 루프를 확인하고 예방하는 매커니즘이 있음 → 루프를 발견하면 바로 트래픽이 통과하지 못하도록 차단해버림

\------------------------------------------------------

\
MC-LAG을 이용하면 LACP를 구성할 때 루프나 STP에 의해 차단되지 않는 네트워크 구조를 만들 수 있음

![](<../../../../.gitbook/assets/image (7).png>)

\


\


AWS가 자연재해에 대응하는 방법 [https://aws.amazon.com/ko/blogs/korea/aws-ready-for-the-next-storm/](https://aws.amazon.com/ko/blogs/korea/aws-ready-for-the-next-storm/)
